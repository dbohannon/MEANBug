"use strict";function e(t,r){function f(e){const t=i.extname(e);if(p.includes(t))return!1;if(e.startsWith("/dev/"))return!1;if(e.includes("node_modules"))return!1;if(n.existsSync(e)){const t=n.statSync(e),i=t.size;if(i>g)return!1}else c.trace("Tried to open a file that doesn't exist: "+e);return!0}function l(e){const t=w.get(e);if(t)return t;for(const t of h)if(n.existsSync(t[0])){const i=n.readFileSync(t[0],"utf8");i.includes(e)&&(w.has(e)||w.set(e,[]),w.get(e).push(t[0]))}else c.trace("Tried to read a file that is no longer exists: "+t[0]),h.delete(t[0]);return w.get(e)}function d(e,t,n){const i=a.sensitiveDataMask,c=n.join(s.EOL);t=t.replace(e,i),new o(r).withDefaults().withContext({maskedPassword:i,connectionString:t,fileNames:c}).submit()}const p=[".jar",".war",".exe",".class",".jsp",".zip",".tar",".7z",".jpg",".jpeg",".png",".gif",".tif",".tiff",".mod"],g=1e5,h=new Map,w=new Map;this.getContextFields=function e(){return["connectionString"]},this.start=function e(){t.services.fs.on(r,"fileOpened",function(e){f(e)&&h.set(e,null)}),t.services.sql.on(r,"dbconnect",function(e){const t=e.config,n="pg"===e.type?"postgres":e.type;let i="",s="";if("string"==typeof t||t instanceof String?(i=u.parsePasswordFromConnectionString(t),s=t):t.password&&(i=t.password,s=u.connectionStringFromConfig(t,n)),i&&i.length>5){const e=l(i);e&&d(i,s,e)}})},e.super_.apply(this,arguments)}const t=require("util"),n=require("fs"),i=require("path"),s=require("os"),r=require("./_AbstractChecker"),o=require("../services/finding-service").FindingBuilder,c=require("../util/logger"),u=require("../util/misc"),a=require("../util/crypto-utils");t.inherits(e,r),module.exports=function(t,n){return new e(t,n)};