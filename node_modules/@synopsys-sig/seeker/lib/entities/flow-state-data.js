"use strict";const e=require("../util/misc"),n=function(n,i,t,s){function r(e){return!e||"number"==typeof e||"string"==typeof e||e instanceof String?e:JSON.stringify(e)}function o(n){return e.isWindows()&&-1!==n.indexOf(":/")?c("win_1",n):c("unix_1",n)}function a(n){return e.isWindows()&&-1!==n.indexOf(":/")?c("win_2",n):c("unix_2",n)}function c(e,n){switch(e){case"win_1":return/at\s(.*)\s\(([A-z]:\/[^:^)]*)(:(\d*):(\d*))?/.exec(n);case"win_2":return/at\s([A-z]:\/[^:]*):(\d*):(\d*)/.exec(n);case"unix_1":return/at\s(.*)\s\(([^:^)]*)(:(\d*):(\d*))?/.exec(n);case"unix_2":return/at\s([^:]*):(\d*):(\d*)/.exec(n)}}function u(n){let i,t;for(let s=0;s<n.length;s++)if(!n[s].includes("__sk_wrapWithBeforeAfterCallbacks")){const r=e.normalizeToUnixPath(n[s]);let c=o(r);if(c?(i=c[2],t=c[4]):(i=(c=a(r))[1],t=c[2]),"native"!==i&&"<anonymous>"!==i)break}return i=i||"",t=t||-1,{fileName:i,lineNumber:t}}function f(){const n={wrapFunctionManually:1,safeExecuteWithoutInstrumentation:3,__sk_requestFinish:4,__sk_requestStarted:2,__sk_submitLfi:8},i=(new Error).stack.split("\n");let t=0,s;for(;t<i.length;){let r=e.normalizeToUnixPath(i[t]);if(Object.keys(n).some(e=>{if(r.includes(e))return s=e,!0}))break;t++}return i.forEach(function(n,i,t){t[i]=e.normalizeToUnixPath(n)}),i.slice(t+(s?n[s]:2))}if(s){const e=f(),n=u(e);this.codeSig=n.fileName,this.codeLine=n.lineNumber,this.stacktrace=e.join("\n")}else this.codeSig="[N/A]",this.codeLine=-1,this.stacktrace="[N/A]";this.type=n,this.value=i instanceof Buffer?e.bufferToStringExcerpt(i):r(i),this.requestDataUuid=t||(process.domain&&process.domain.__sk_local&&process.domain.__sk_local.requestData?process.domain.__sk_local.requestData.uuid:void 0)};module.exports=n;