"use strict";function e(){function e(){r=[n.normalizeToUnixPath(i.config.bootstrapCfg.tempDir),n.normalizeToUnixPath(i.config.bootstrapCfg.homeDir)];for(let e in s){const t=s[e];for(let o=0;o<r.length;o++)if(0===r[o].indexOf(n.normalizeToUnixPath(t))){delete s[e];break}}}function t(){const e=i.services.instrumentation;e.register({moduleId:"fs",methodNames:"open",callbacks:{__sk_doBefore:function(e,t){const n=t[0],i=t[1],r=t[t.length-1];module.exports.emit("fileOpened",n),o(n,i)&&(t[t.length-1]=function(e,t){t>0&&(s[t]=n),r(e,t)})}}}),e.register({moduleId:"fs",methodNames:"openSync",callbacks:{__sk_doBefore:function(e,t){const n=t[0];module.exports.emit("fileOpened",n)},__sk_doAfter:function(e,t,n){const i=n[0];return o(i,n[1])&&(s[t]=i),t}}}),e.register({moduleId:"fs",methodNames:["close","closeSync"],callbacks:{__sk_doAfter:function(e,t,n){return delete s[n[0]],t}}}),e.register({moduleId:"fs",methodNames:["write","writeSync"],callbacks:{__sk_doBefore:function(e,t){const o=t[0],r=t[1],l=s[o];if(l){let e;if(r instanceof Buffer){const t=i.services.datatainting.getTaintInfo(r);e=n.bufferToStringExcerpt(r),t&&i.services.datatainting.taintUpdate(null,e,t)}else e=r;module.exports.emit("fileOpened",l),module.exports.emit("write",{filepath:l,value:e})}}}}),e.register({moduleId:"fs",methodNames:["readFile","readFileSync"],callbacks:{__sk_doBefore:function(e,t){module.exports.emit("fileOpened",t[0])}}}),e.register({moduleId:"fs",methodNames:["unlink","unlinkSync"],callbacks:{__sk_doBefore:function(e,t){o(t[0])&&(module.exports.emit("fileOpened",t[0]),module.exports.emit("unlink",t[0]))}}})}function o(e,t){if("r"===t)return!1;for(let t=0;t<r.length;t++)if(0===n.normalizeToUnixPath(e).indexOf(r[t]))return!1;return!0}let i,r=[];const s={};this.init=function(e){i=e},this.start=function(){t(),e()}}const t=require("util"),n=require("../util/misc");t.inherits(e,require("./_AbstractService")),module.exports=new e;